# 応用機能のご紹介

本アプリケーションで設定できる全てのことを紹介します。  
専門的な内容を含みます。よくわからない場合は、AIに聞いてみるとわかりやすいかもしれません。

## 再起動ボタン
ペルソナ一覧画面の右上の電源マークは再起動ボタンです。  
サーバーを再起動することが出来ます。

調子が悪くなったときや、一部の設定の反映に使います。

## ペルソナ設定の全項目説明

ペルソナごとの設定です。

### 表示名

画面上のペルソナの名前です。  
表示されるのみで、AIに送信はされません。

### 言語モデル名 (空欄で既定のモデルを使用)

ペルソナに別途言語モデルを割り当てたいときに使います。  
空欄にすると、システム設定の言語モデルを使用します。

### システムプロンプト

システムプロンプトです。

### メモリ一覧

メモリ内容を表示しています。  
編集は、memory.yamlを直接編集してください。

### アイコン・背景画像

アイコンや背景画像です。

### (応用) 定期タイマー周期 (分)
定期的に自動でペルソナを起動することが出来ます。連続一定回数で自動停止します。(0=無効)   
ユーザーが発言すると、連続カウントはリセットされます。  
エラーが発生すると停止します。  

この発言は、アクティブなときにしか行われません。(つまり別のペルソナを使っている間は停止します。)  

※システム設定から、自発的発言タイマーをオンにする必要があります。
  一定回数もシステム設定から設定できます。

### (応用) Webhook URL
DiscordやSlackなどにAIの発言を送信することが出来ます。  
[Discordの設定はこちらをご参考ください](https://zenn.dev/lambta/articles/5edbda4ccb1ec6)

### (応用) Webhook本文
POSTで送信されます。%text%と記載した箇所が本文に置換されます。(URLか本文が空欄の場合は送信されません)  

以下はDiscordに本文を送る場合のサンプルです。  
`{"content":"%text%"}`

## システム設定の全項目説明

システム全体に影響する設定です。

### 基本設定

アプリケーションの動作に不可欠な基本的な設定です。

#### LLMエンドポイントURL (`LlmEndpointUrl`)
- **項目名:** Base URL
- **説明:**
  AIとの会話を実現するための、LLM（大規模言語モデル）プロバイダーが提供するAPIのURLを入力します。

#### LLM APIキー (`LlmApiKey`)
- **項目名:** APIキー
- **説明:**
  LLMプロバイダーのサービスを利用するために必要な認証キーです。もしご自身のPC内などで動作するローカルLLMを使用する場合は、空欄のままで構いません。
- **補足:** [OpenRouter](https://openrouter.ai/settings/keys)をご利用の場合は、こちらのリンク先でキーを作成できます。

#### 既定の言語モデル (`DefaultModel`)
- **項目名:** 既定の言語モデル
- **説明:**
  どのAIモデルを使用するかを指定します。ここで指定したモデルが、会話の標準モデルとして使用されます。（キャラクターごとに個別のモデルを設定することも可能です）
- **入力例:** `google/gemini-2.5-pro`
- **補足:** [OpenRouter](https://openrouter.ai/models)をご利用の場合は、こちらのリンク先で利用可能なモデルを探せます。

#### ユーザーの表示名 (`YourName`)
- **項目名:** ユーザーの表示名
- **説明:**
  チャット画面に表示されるあなたの名前です。この名前はAIには送信されません。
- **入力例:** `山田太郎`

#### 休憩おしらせ基準値 (`BreakReminderThreshold`)
- **項目名:** 休憩おしらせ基準値
- **説明:**
  直近8時間のメッセージ投稿数がこの値を超えた場合に、休憩をおすすめするメッセージが画面に表示されます。

#### 会話履歴の最大トークン数 (`TalkHistoryCutoffThreshold`)
- **項目名:** 会話履歴の最大トークン数
- **説明:**
  AIに送信する過去の会話履歴の量を制限します。この数値を超えた古い会話はAIに送信されなくなるため、AIはその内容を忘れてしまいます。
  - **小さい値:** AIが会話をすぐに忘れるようになりますが、料金は安くなります。
  - **大きい値:** 長い文脈を記憶できますが、処理時間が長くなり、料金も高くなる傾向があります。
- **補足:** あくまで概算のため、実際には1000トークン以内で上振れることが多いです。

#### ローカルアクセスのみ許可 (`LocalOnly`)
- **項目名:** ローカルアクセスのみ許可
- **説明:**
  この設定をオンにすると、アプリケーションを実行しているPCからのみアクセスできるようになります。スマートフォンなど、同じネットワーク内の他のデバイスからアクセスしたい場合は、オフにしてください。  
  **※この設定を変更した後は、アプリケーションの再起動が必要です。**

---

### 応用設定

AIの応答やシステムの動作に関する、より細かい設定です。

#### タイムアウト秒数 (`TimeoutSeconds`)
- **項目名:** タイムアウト秒数
- **説明:**
  AIからの応答を待つ最大時間（秒）です。性能が高いAIサービスでは短く、ご自身のPCで動作するローカルLLMなど、応答に時間がかかる場合は長めに設定する必要があります。

#### Temperature (`Temperature`)
- **項目名:** Temperature
- **説明:**
  AIの応答の「創造性」や「多様性」を調整するパラメータです。0.0から2.0の範囲で設定します。(モデルごとに効果が異なります)
  - **0.0:** 同じ入力には、ほぼ同じ出力になります。
  - **0.3:** 事務処理などに使います。
  - **0.5:** 少し硬めです。
  - **0.7:** 最も一般的な数値です。
  - **1.0:** 少し高めです
  - **1.2:** 壊れ始めます
  - **1.5:** 結構壊れます。
  - **2.0:** 完全に意味のない文になることがあります。

#### 最大トークン数 (`MaxTokens`)
- **項目名:** 最大トークン数
- **説明:**
  AIが一度の応答で生成する文章の最大長の制限です。基本的に変更する必要はありません。小さくすると途中でぶった切られるようになります。

#### 画像履歴の保持上限 (`PhotoCutoff`)
- **項目名:** 画像履歴の保持上限
- **説明:**
  会話に画像を添付した際、何件前のメッセージまで画像情報をAIに送信するかを設定します。古い画像は送信されなくなるため、トークン数（料金）の節約になります。伸ばすと、画像添付時に料金が跳ね上がりやすくなります。

#### タイムゾーン (`TimeZone`)
- **項目名:** タイムゾーン
- **説明:**
  システムが日時を扱う際に使用するタイムゾーンを指定します。空欄の場合は、サーバーの標準設定が使用されます。
- **入力例:** `Asia/Tokyo`

#### HTTPポート (`HttpPort`)
- **項目名:** HTTPポート
- **説明:**
  ブラウザからこのアプリケーションにアクセスする際のポート番号です。他のソフトと被っていたり、複数起動したい場合に変更します。
  **※この設定を変更した後は、アプリケーションの再起動が必要です。**
- **データ型:** 整数 (1～65535)

#### システム設定変更をローカル限定にする (`SystemSettingsLocalOnly`)
- **項目名:** システム設定変更をローカル限定にする
- **説明:**
  この設定をオフにすると、設定ページのアクセスをアプリケーション実行中のPC以外からもアクセスできるようになります。LAN内の他のデバイスから設定を変更したい場合のみ、オフにしてください。
  **※この設定を変更した後は、アプリケーションの再起動が必要です。**
- **データ型:** ブーリアン（オン/オフ）

#### Howto機能を有効化 (`EnableHowto`)
AIがこのアプリケーション自体の使い方を理解できるツールを有効にします。  
オフにすると、AIはこのツールの存在を認識できなくなります。

#### メモリ機能を有効化 (`EnableMemory`)
AIが指定された大切な情報を記憶し続けられるようになります。  
オフにすると、AIはこのツールの存在を認識できなくなります。

#### JavaScriptサンドボックスを有効化 (`EnableJavascript`)
AIが計算などのために、安全な環境でJavaScriptコードを実行できるようになります。（外部への通信はできません）  
オフにすると、AIはこのツールの存在を認識できなくなります。

#### プロジェクト機能を有効化 (`EnableProject`)
AIが`project`フォルダ内のファイルを読み書きできるようになります。  
オフにすると、AIはこのツールの存在を認識できなくなります。

#### ユーザーの発言にタイムスタンプを付与 (`EnableTimestamps`)
AIがユーザーの発言時刻を認識できるようになります。(時間経過を認識するようになります)  
オフにすると、AIは時間経過を認識できなくなります。

#### 現在時刻挿入を有効化 (`EnableCurrentTime`)
AIが現在の正確な日時を取得できるようになります。  
オフにすると、AIは現在時刻を認識できなくなります。  
(ただしタイムスタンプが有効な場合はオフにしても特に効果はありません)

#### 統計と休憩リマインダーを有効化 (`EnableStatisticsAndBreakReminder`)
AIが会話の頻度を認識し、休憩が必要かどうかを判断できるようになります。  
オフにすると、AIは会話統計情報や休憩の必要性を認識できなくなります。

#### Webhook通知を有効化 (`EnableWebhook`)
AIの発言を、指定した外部サービス(DiscordやSlack等)に通知できるようになります。  
利用するには、システム設定でオンにしたうえで、さらにペルソナ設定から別途詳細設定をする必要があります。

#### 自動アップデートチェック (`EnableAutoUpdateCheck`)
アプリケーション起動時に、新しいバージョンがないか自動で確認します。

#### コンソールモニターを有効化 (`EnableConsoleMonitor`)
実行中の画面（コンソール）に、常に現在の状態を表示します。詳細なログを見たい場合はオフにしてください。

#### 自発的発言タイマーを有効化 (`EnableTimerGenerate`)
この機能を有効にすると、AIが人間からの発言がなくても、自発的に話しかけてくるようになります。  
格言botのように使ったり、音楽を勝手に再生したりといった挙動を実現できるようになったりします。  

利用するには、システム設定でオンにしたうえで、さらにペルソナ設定から別途詳細設定をする必要があります。

- **関連設定:**
    - **自発的発言タイマーメッセージ (`TimerGenerateMessage`):** タイマーが作動した際にAIに送られる指示文です。AIは何ができるのかが分かる内容にしてください。（例: `タイマーイベント: 自由に独り言を言ったり、ツールを呼び出したりすることが出来ます。`）
    - **自発的発言タイマー生成上限 (`TimerGenerateLimitMax`):** AIが連続で自発的に発言できる回数の上限です。回数が多いほど会話が続く可能性がありますが、料金も増加する可能性があります。

!!! danger
    ツール呼び出しをAIは勝手に行います。基本ツールは安全なように出来ていますが、  
    画像生成を有効にしたり、MCPツールを有効にしている場合、自発的発言に伴い破壊的な挙動をする可能性があります。
    危険なツールを入れているときにタイマーをオンにしないことをおすすめします。

#### MCPツール連携を有効化 (`EnableMcpTools`)
[Model Context Protocol](https://cursor.com/ja/docs/context/mcp)に対応した外部ツールとの連携を有効にします。`data`フォルダ内の`mcp.json`に設定を記述する必要があります。

!!! danger
    外部ツールの挙動に関して、本アプリケーションでは一切の制御ができず、一切の責任を負いません。

#### 画像生成を有効化 (`EnableImageGeneration`)
AIがプロンプト（指示文）に基づいて画像を生成する機能を使えるようにします。  

!!! danger
    料金が跳ね上がりやすくなります。ご注意ください。

#### 画像生成LLM Base URL (`ImageGenerationEndpointUrl`)
画像生成に対応したLLMプロバイダーのAPIのURLです。現在、[OpenRouter](https://github.com/gpsnmeajp/chocolatelmlite)のみ対応しています。

#### 画像生成APIキー (`ImageGenerationApiKey`)
画像生成サービスを利用するためのAPIキーです。[OpenRouter](https://openrouter.ai/settings/keys)で作成できます。

#### 画像生成モデル (`ImageGenerationModel`)
画像生成に使用するAIモデル名です。[OpenRouterのモデル一覧](https://openrouter.ai/models?fmt=cards&output_modalities=image)で探せます。

#### デバッグモード (`DebugMode`)
- **項目名:** デバッグモード
- **説明:**
  開発者向けに、より詳細な動作ログを出力するなどの機能を有効にします。パフォーマンスが低下します。通常はオフのままにしてください。logsフォルダ内に通信トレース情報が出力されます。

---